<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>vps-deploy | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="ubuntu下的操作  创建普通用户, 之后所有的操作使用新用户登录进行  adduser kmaidol 创建用户kmaidol 设置sodu权限  apt-get install vim chmod 744 /etc/sudoers 获取写权限 vim /etc/sudoers 编辑如下, 获得sudo权限-# User privilege specification-root ALL=(A">
<meta name="keywords" content="vps,linode,vpn,nginx">
<meta property="og:type" content="article">
<meta property="og:title" content="vps-deploy">
<meta property="og:url" content="http://yoursite.com/2016/07/06/vps_deploy/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="ubuntu下的操作  创建普通用户, 之后所有的操作使用新用户登录进行  adduser kmaidol 创建用户kmaidol 设置sodu权限  apt-get install vim chmod 744 /etc/sudoers 获取写权限 vim /etc/sudoers 编辑如下, 获得sudo权限-# User privilege specification-root ALL=(A">
<meta property="og:updated_time" content="2017-04-12T23:22:16.593Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="vps-deploy">
<meta name="twitter:description" content="ubuntu下的操作  创建普通用户, 之后所有的操作使用新用户登录进行  adduser kmaidol 创建用户kmaidol 设置sodu权限  apt-get install vim chmod 744 /etc/sudoers 获取写权限 vim /etc/sudoers 编辑如下, 获得sudo权限-# User privilege specification-root ALL=(A">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <!-- Piwik -->
  <script type="text/javascript">
    var _paq = _paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="//tracker.doaidea.com/";
      _paq.push(['setTrackerUrl', u+'piwik.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  <!-- End Piwik Code -->
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="null" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">maidol</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
						<li>Über</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="#" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="#" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/cmd/" style="font-size: 10px;">cmd</a> <a href="/tags/deploy/" style="font-size: 20px;">deploy</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/docker-compose/" style="font-size: 10px;">docker-compose</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/iaas/" style="font-size: 10px;">iaas</a> <a href="/tags/ipv6/" style="font-size: 10px;">ipv6</a> <a href="/tags/linode/" style="font-size: 10px;">linode</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/paas/" style="font-size: 10px;">paas</a> <a href="/tags/saas/" style="font-size: 10px;">saas</a> <a href="/tags/tmux/" style="font-size: 10px;">tmux</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a> <a href="/tags/vpn/" style="font-size: 10px;">vpn</a> <a href="/tags/vps/" style="font-size: 10px;">vps</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/weichat/" style="font-size: 10px;">weichat</a> <a href="/tags/二进制格式/" style="font-size: 10px;">二进制格式</a> <a href="/tags/入门/" style="font-size: 10px;">入门</a> <a href="/tags/公众号/" style="font-size: 10px;">公众号</a> <a href="/tags/分布式/" style="font-size: 10px;">分布式</a> <a href="/tags/基础/" style="font-size: 10px;">基础</a> <a href="/tags/微信/" style="font-size: 10px;">微信</a> <a href="/tags/文本/" style="font-size: 10px;">文本</a> <a href="/tags/自动化部署/" style="font-size: 10px;">自动化部署</a> <a href="/tags/集群/" style="font-size: 10px;">集群</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">奥巴马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">卡卡的美丽传说</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">本泽马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">吉格斯的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">习大大大不同</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">托蒂的博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">maidol</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="null" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">maidol</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-vps_deploy" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/06/vps_deploy/" class="article-date">
  	<time datetime="2016-07-06T14:37:00.000Z" itemprop="datePublished">2016-07-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      vps-deploy
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linode/">linode</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vpn/">vpn</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vps/">vps</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>ubuntu下的操作 </li>
<li>创建普通用户, 之后所有的操作使用新用户登录进行<blockquote>
<ul>
<li><code>adduser kmaidol</code> 创建用户kmaidol</li>
<li>设置sodu权限<blockquote>
<ul>
<li><code>apt-get install vim</code></li>
<li><code>chmod 744 /etc/sudoers</code> 获取写权限</li>
<li><code>vim /etc/sudoers</code> 编辑如下, 获得sudo权限<br>-# User privilege specification<br>-root ALL=(ALL) ALL<br>-kmaidol ALL=(ALL) ALL</li>
<li>使用 kmaidol 登陆 or <code>su kmaidol</code>切换</li>
<li>必须确保新增用户获取了sudo权限, 并且可以远程登陆之后, 才做以下的操作, 以下的操作必须由新增的用户进行操作, 取消root远程登录<blockquote>
<ul>
<li>下面还有一个问题，现在服务器开着root这个用户，远程可以通过root用户登录，这让人很不放心啊，所以得取消root远程登录</li>
<li><code>sudo vim /etc/ssh/sshd_config</code> 修改PermitRootLogin 的值为 yes</li>
<li>然后重启ssh <code>sudo service ssh restart</code> 再次尝试使用root登录，会发现登不上去了</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
<li>设置时区<blockquote>
<ul>
<li><code>tzselect</code> 执行命令按提示操作</li>
<li>设置localtime <code>sudo cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</code></li>
<li><code>date</code> 查看时间</li>
<li>更多时区信息可以在以下目录中去选取：<code>cd /usr/share/zoneinfo/</code></li>
<li>与时间服务器上的时间同步的方法<blockquote>
<ul>
<li>安装ntpdate工具 <code>sudo apt-get install ntpdate</code> </li>
<li>同步 <code>sudo ntpdate cn.pool.ntp.org</code> </li>
<li>将系统时间写入硬件时间 <code>hwclock --systohc</code> </li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
<li>禁用ipv6<blockquote>
<ul>
<li><code>vim /etc/sysctl.conf</code></li>
<li>添加内容, 如果是 OpenVZ 环境，请把最后一条的 eth0 改成 venet0 ，同理如果网卡是 eth1 或者其他的名字，也要相应修改。<br>net.ipv6.conf.all.disable_ipv6 = 1<br>net.ipv6.conf.default.disable_ipv6 = 1<br>net.ipv6.conf.lo.disable_ipv6 = 1<br>net.ipv6.conf.eth0.disable_ipv6 = 1</li>
<li>执行 <code>sudo sysctl -p</code></li>
<li><code>ifconfig</code> 查看</li>
</ul>
</blockquote>
</li>
<li>安装 nvm node<blockquote>
<ul>
<li>安装 curl <code>sudo apt-get install curl</code></li>
<li><code>curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.31.0/install.sh | bash</code></li>
<li>激活 nvm, 进入用户文件夹 /home/kmaidol, 执行 <code>. ~/.nvm/nvm.sh</code></li>
<li>安装node <code>nvm install v6</code><blockquote>
<ul>
<li>登陆默认启动版本 <code>nvm alias default 0.10.x</code></li>
</ul>
</blockquote>
</li>
<li>安装nrm, 管理下载源  <code>npm install -g nrm</code>  命令 nrm ls/use/…</li>
<li>安装bower  <code>npm install -g bower</code></li>
<li>安装pm2  <code>npm install -g pm2</code></li>
</ul>
</blockquote>
</li>
<li>安装 git<blockquote>
<ul>
<li><code>sudo apt-get install git</code></li>
</ul>
</blockquote>
</li>
<li>源码安装shadowsocks 一次性验证<blockquote>
<ul>
<li><code>sudo apt-get update</code> <code>sudo apt-get install -y python python-setuptools</code></li>
<li><code>git clone https://github.com/shadowsocks/shadowsocks.git</code></li>
<li><code>cd ./shadowsocks</code></li>
<li><code>git checkout master</code></li>
<li><code>sudo python setup.py install</code></li>
<li><code>ssserver -h</code></li>
<li>添加一次性验证 运行ssserver 时增加参数 <code>-a</code>, 或者 ss.json 文件添加 <code>&#39;auth&#39;: true</code></li>
<li>ss.json {<pre><code>   &quot;server&quot;: &quot;159.203.234.63&quot;,
   &quot;port_password&quot;: {
           &quot;10080&quot;:&quot;123456&quot;
   },
   &quot;timeout&quot;: 300,
   &quot;method&quot;: &quot;aes-256-cfb&quot;
}
</code></pre></li>
<li>启动shadowsocks <code>sudo ssserver --manager-address 127.0.0.1:6001 -c ss.json -d start</code>   -d 代表守护进程运行 , <code>sudo ssserver -d stop</code> </li>
<li>sslocal是linux的shadowsocks客户端, 执行 <code>sslocal -h</code> 查看使用方法 </li>
</ul>
</blockquote>
</li>
<li>docker 部署shadowsocks<blockquote>
<ul>
<li><code>docker pull oddrationale/docker-shadowsocks</code> </li>
<li>This image uses ENTRYPOINT to run the containers as an executable <code>docker run -d -p 1984:1984 oddrationale/docker-shadowsocks -s 0.0.0.0 -p 1984 -k $SSPASSWORD -m aes-256-cfb</code>  For more command line options, refer to the <a href="https://github.com/shadowsocks/shadowsocks" target="_blank" rel="external">shadowsocks documentation</a></li>
</ul>
</blockquote>
</li>
<li>安装mongodb<blockquote>
<ul>
<li><code>sudo apt-get install mongodb</code></li>
<li>apt-get 安装后默认会作成服务 <code>/etc/init.d/mongodb</code> <code>sudo service mongodb restart/start/stop/status</code> </li>
<li><code>mongod -h</code> 查看帮助,  mongod是服务程序, mongodb封装了mongod, 而mongo是客户端shell </li>
<li>mongodb 实现远程连接<blockquote>
<ul>
<li>1,添加管理员账 <blockquote>
<ul>
<li><code>mongo</code> 本机登陆mongo</li>
<li><blockquote>
<p>use admin<br>switched to db admin<br>db.addUser(‘kmaidol’,’xxxxxx’)</p>
</blockquote>
</li>
</ul>
</blockquote>
</li>
<li><ol>
<li>配置/etc/mongodb.conf<blockquote>
<ul>
<li>#bind_ip = 127.0.0.1   //注释此行 </li>
<li>auth = true       //将此行前的注释去掉</li>
</ul>
</blockquote>
</li>
</ol>
</li>
<li>3，重启mongodb<blockquote>
<ul>
<li><code>/etc/init.d/mongodb</code>  <code>sudo service mongodb restart</code>  </li>
</ul>
</blockquote>
</li>
<li><ol>
<li>防火墙开放27017端口<blockquote>
<ul>
<li><code>iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 27017 -j ACCEPT</code></li>
</ul>
</blockquote>
</li>
</ol>
</li>
<li>如果需要远程登陆指定的数据库, 需要在对应的数据库里创建用户(). 例如有数据库 test, 则<code>use test</code>, 再在test数据库创建用户 <code>db.addUser(&#39;kmaidol&#39;,&#39;xxxxxx&#39;)</code>, 之后就可以使用这个用户访问test</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
<li>安装tmux<blockquote>
<ul>
<li><code>apt-get install tmux</code></li>
<li>新建会话 <code>tmux new -s @session</code></li>
<li>进入已打开的会话 <code>tmux a -t @session</code></li>
</ul>
</blockquote>
</li>
<li>部署 shadowsocks-manager<blockquote>
<ul>
<li>获取源码 <code>git clone https://github.com/shadowsocks/shadowsocks-manager.git</code></li>
<li>安装 <code>npm install -g bower</code> <code>cd shadowsocks-manager</code> <code>npm install</code> <code>bower install</code></li>
<li><code>cd shadowsocks-manager</code> <code>mv config.js.sample config.js</code> <code>node server</code></li>
</ul>
</blockquote>
</li>
<li><p>安装nginx</p>
<blockquote>
<ul>
<li><code>sudo apt-get install nginx</code></li>
<li>常用命令 启动<code>sudo nginx -c filename</code> 停止<code>sudo nginx -s stop/quit/</code> <code>pkill -9 nginx</code></li>
<li>重载配置 <code>sudo nginx -s reload</code></li>
<li>检查配置文件是否正确 <code>sudo nginx -t</code></li>
<li>nginx 配置 (含ssl)<blockquote>
<ul>
<li>###<br>  worker_processes 1;<br>  events {<br>  }<br>  http {<br>  #负责压缩数据流<br>  gzip              on;<br>  gzip_min_length   1000;<br>  gzip_types        text/plain text/css application/x-javascript;</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
<pre><code>#设定负载均衡的服务器列表
#weigth参数表示权值，权值越高被分配到的几率越大
upstream shadowsocksManager{
server localhost:6003; #shadowsocksManager     
}
# test #
server {
listen       80;
server_name  v1.maidol.pw;
location / {
        proxy_pass   http://www.google.com;
}
}
# maidol.pw #   
server {
#侦听的80端口
listen       80;
listen       443;
server_name  maidol.pw;
#启用SSL模块
ssl on;
#证书文件放置路径
ssl_certificate /home/kmaidol/cert/1_maidol.pw_bundle.crt;
#私钥文件放置路径
ssl_certificate_key /home/kmaidol/cert/2_maidol.pw.key;

location / {
        proxy_pass   http://shadowsocksManager;    #在这里设置一个代理，和upstream的名字一样
}
}
}
</code></pre></li>
<li>安装mysql(源码编译安装), 并设置远程登陆<blockquote>
<ul>
<li>安装环境准备 <blockquote>
<ul>
<li><code>sudo apt-get install build-essential libncurses5-dev cmake</code> </li>
<li>创建mysql用户 并且禁止登录 <code>sudo groupadd mysql</code> <code>sudo useradd -s /sbin/nologin -g mysql mysql</code> <code>sudo mkdir -p /data/mysql/</code> <code>sudo mkdir -p /data/mysql/data/</code></li>
</ul>
</blockquote>
</li>
<li>mysql5.7.5之后版本都要安装boost包。所以我选择是下载已经自带boost安装包的mysql安装包：</li>
<li><code>cd /usr/local/src</code></li>
<li><code>wget http://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-boost-5.7.13.tar.gz</code></li>
<li><code>tar zxvf mysql-boost-5.7.13.tar.gz</code> <code>cd mysql-5.7.13/</code></li>
<li>网上某些教程多了这一句 <code>sh BUILD/autorun.sh</code>, 安装前不要执行, 否则会安装失败</li>
<li>MySQL从5.5版本开始，通过./configure进行编译配置方式已经被取消，取而代之的是cmake工具 </li>
<li>`cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql \<pre><code>-DSYSCONFDIR=/etc \
-DMYSQL_DATADIR=/data/mysql/data \
-DWITH_MYISAM_STORAGE_ENGINE=1 \
-DWITH_INNOBASE_STORAGE_ENGINE=1 \
-DWITH_PARTITION_STORAGE_ENGINE=1 \
-DWITH_FEDERATED_STORAGE_ENGINE=1 \
-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \
-DEXTRA_CHARSETS=all \
-DDEFAULT_CHARSET=utf8mb4 \
-DDEFAULT_COLLATION=utf8mb4_general_ci \
-DWITH_EMBEDDED_SERVER=1 \
-DENABLED_LOCAL_INFILE=1 \
-DENABLE_DTRACE=0 \
-DWITH_BOOST=boost \
-DENABLE_DOWNLOADS=1`
</code></pre></li>
<li>mysql configure 安装参数解释：<blockquote>
<ul>
<li>-DCMAKE_INSTALL_PREFIX=/usr/local/mysql #指定安装路径<br>-DDEFAULT_CHARSET=utf8mb4 #默认使用utf8mb4字符<br>-DDEFAULT_COLLATION=utf8mb4_general_ci #校验字符<br>-DWITH_INNOBASE_STORAGE_ENGINE=1 #安装innodb引擎<br>-DWITH_BOOST=boost #指定boost的安装位置<br>-DENABLE_DOWNLOADS #是否要下载可选的文件。例如，启用此选项设置为1, cmake将下载谷歌所使用的测试套件运行单元测试 </li>
</ul>
</blockquote>
</li>
<li>编译 <code>make</code>  安装 <code>sudo make install</code> </li>
<li><code>sudo chown -R mysql:mysql /usr/local/mysql</code> <code>sudo chown -R mysql:mysql /data/mysql/</code> #对mysql目录进行赋予权限 </li>
<li>生成mysql配置文件 <code>sudo cp /usr/local/mysql/support-files/my-default.cnf /etc/my.cnf</code> </li>
<li>对数据库进行初始化 先清空 /data/mysql/data  <code>sudo /usr/local/mysql/bin/mysqld --initialize --user=mysql --explicit_defaults_for_timestamp=1</code></li>
<li>[Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use –explicit_defaults_for_timestamp server option (see documentation for more details).<br>解决：/etc/my.cnf 加上 explicit_defaults_for_timestamp = 1 </li>
<li>复制文件mysql.server 可以使用service 命令进行控制 <code>sudo cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysql</code> <code>sudo service mysql start</code> #启动mysql</li>
<li><h1 id="修改密码：MySQL5-7在安装完后，第一次启动时，会在root目录下生产一个随机的密码，文件名为-mysql-secret-cat-root-mysql-secret"><a href="#修改密码：MySQL5-7在安装完后，第一次启动时，会在root目录下生产一个随机的密码，文件名为-mysql-secret-cat-root-mysql-secret" class="headerlink" title="修改密码：MySQL5.7在安装完后，第一次启动时，会在root目录下生产一个随机的密码，文件名为 .mysql_secret, cat /root/.mysql_secret"></a>修改密码：MySQL5.7在安装完后，第一次启动时，会在root目录下生产一个随机的密码，文件名为 .mysql_secret, <code>cat /root/.mysql_secret</code></h1></li>
<li>登录数据库修改密码 <code>/usr/local/mysql/bin/mysql -u root -p</code> </li>
<li>输入密码回车。登录成功后，输入以下字符，来修改密码，比如我要修改密码为root <code>set password = password(&#39;root&#39;);</code> </li>
<li><h1 id="配置环境变量，否则-mysql-客户端命令不可用"><a href="#配置环境变量，否则-mysql-客户端命令不可用" class="headerlink" title="配置环境变量，否则 mysql 客户端命令不可用"></a>配置环境变量，否则 mysql 客户端命令不可用</h1><blockquote>
<ul>
<li><code>vim /etc/profile</code> 在文件末尾添加 PATH=/usr/local/mysql/bin:$PATH  export PATH </li>
<li><code>source /etc/profile</code> </li>
</ul>
</blockquote>
</li>
<li>MySQL服务器上添加一个允许远程访问的用户<blockquote>
<ul>
<li>用root用户登陆, <code>mysql -u root -p</code></li>
<li><code>grant all privileges on *.* to 创建的用户名@&quot;%&quot; identified by &quot;密码&quot;;</code> <code>flush privileges;</code> # 刷新刚才的内容. 格式：grant 权限 on 数据库名.表名 to 用户@登录主机 identified by “用户密码”;@ 后面是访问mysql的客户端IP地址（或是 主机名） % 代表任意的客户端，如果填写 localhost 为本地访问 那此用户就不能远程访问该mysql数据库了 </li>
<li>查看用户 <code>&gt; use mysql;</code> <code>&gt; select user, host from user;</code></li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
<li>源码安装redis, 并设置远程登陆<blockquote>
<ul>
<li>安装make <code>sudo apt-get make</code></li>
<li>获取安装包 <code>wget http://download.redis.io/releases/redis-3.2.1.tar.gz</code></li>
<li>安装 <code>tar xzf redis-3.2.1.tar.gz</code> <code>cd redis-3.2.1</code> <code>make</code> <code>make test</code> </li>
<li>The binaries that are now compiled are available in the src directory. Run Redis with: <code>src/redis-server --port 6380</code> or <code>src/redis-server /etc/redis/redis.conf</code>  </li>
<li>You can interact with Redis using the built-in client: <code>src/redis-cli</code></li>
<li>如果要把redis安装到系统, 执行 <code>cd ./src</code> <code>sudo make install</code></li>
<li>设置守护进程运行redis<blockquote>
<ul>
<li><code>vim redis.conf</code> 修改 <code>daemonize no</code> -&gt; <code>daemonize yes</code></li>
</ul>
</blockquote>
</li>
<li><code>sudo make install</code>, 执行这句命令可把redis安装到系统, 就无需使用 <code>src/redis-server</code> 来启动, 直接 <code>redis-server</code> , 不指定端口和配置文件, 会默认读取路径 /etc/redis.conf </li>
<li>启动redis服务, 一般需指定自定义的配置文件 <code>redis-server redis.conf</code>, 不指的话则读取默认配置 </li>
<li>停止redis服务 <code>redis-cli shutdown</code> </li>
<li>如果要设置redis服务, <code>sudo cp ./utils/redis_init_script /etc/init.d/redis</code> <blockquote>
<ul>
<li><code>sudo service redis start/stop/...</code> </li>
<li><code>service redis start</code> 默认配置文件读取 /etc/redis/.. , <code>sudo cp ./redis.conf /etc/redis/redis.conf</code></li>
</ul>
</blockquote>
</li>
<li>设置远程登陆, 并开启密码验证 <blockquote>
<ul>
<li><code>vim redis.conf</code>, 找到requirepass，然后修改如下: requirepass yourpassword; <code># bind 127.0.0.1 maidol.pw</code> 去除 # </li>
<li>登陆 <code>redis-cli -h ip -p port -a yourpassword</code> </li>
</ul>
</blockquote>
</li>
<li>设置 redis 开机启动</li>
</ul>
</blockquote>
</li>
<li>安装hexo<blockquote>
<ul>
<li>配置环境<blockquote>
<ul>
<li>安装node, 安装git</li>
<li>安装hexo<blockquote>
<ul>
<li><code>mkdir blog</code> <code>cd ./blog</code> <code>npm install -g hexo</code> </li>
<li>初始化 <code>hexo init</code> or <code>npm install</code></li>
<li>生成静态页 <code>hexo generate</code> or <code>hexo g</code> </li>
<li>本地启动服务 <code>hexo server</code> 浏览器输入<a href="http://localhost:4000" target="_blank" rel="external">http://localhost:4000</a> </li>
</ul>
</blockquote>
</li>
<li>配置Github, 部署到Github <blockquote>
<ul>
<li>登陆Github, 建立Repository. 建立与你用户名对应的仓库，仓库名必须为【your_user_name.github.io】 </li>
<li>建立关联 <blockquote>
<ul>
<li><code>cd ./blog</code> <code>vim _config.yml</code> 翻到最后, 如下编辑<br>deploy:<br>type: git<br>repo: <a href="https://github.com/maidol/maidol.github.io.git" target="_blank" rel="external">https://github.com/maidol/maidol.github.io.git</a><br>branch: master </li>
<li>执行命令 <code>npm install hexo-deployer-git --save</code> </li>
<li>配置github用户信息 <code>git config --global user.email &quot;you@example.com&quot;</code> <code>git config --global user.name &quot;Your Name&quot;</code> </li>
<li>本地执行部署 <code>git pull</code> <code>hexo deploy</code> 浏览器中输入<a href="http://maidol.github.io/" target="_blank" rel="external">http://maidol.github.io/</a> </li>
<li>每次部署的步骤 <code>hexo clean</code> <code>hexo generate</code> <code>hexo deploy</code> </li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
<li>Hexo的常用命令 <blockquote>
<ul>
<li><code>hexo new&quot;postName&quot;</code> #新建文章 </li>
<li><code>hexo new page&quot;pageName&quot;</code> #新建页面 </li>
<li><code>hexo generate</code> #生成静态页面至public目录 </li>
<li><code>hexo server</code> #开启预览访问端口 </li>
<li><code>hexo deploy</code> #将.deploy目录部署到GitHub </li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
<li>安装cloud9/core <a href="https://github.com/c9/core" target="_blank" rel="external">https://github.com/c9/core</a><blockquote>
<ul>
<li><code>git clone https://github.com/c9/core.git</code> c9</li>
<li><code>cd c9</code></li>
<li><code>scripts/install-sdk.sh</code></li>
<li><code>node server.js --auth username:password</code></li>
<li>visit <a href="http://localhost:8181/ide.html" target="_blank" rel="external">http://localhost:8181/ide.html</a></li>
</ul>
</blockquote>
</li>
<li>ubuntu安装rabbimq<blockquote>
<ul>
<li>rabbimq依赖erlang<blockquote>
<ul>
<li>安装erlang <code>wget http://erlang.org/download/otp_src_19.0.tar.gz</code>  <code>tar zxvf otp_src_19.0.tar.gz</code> <code>cd otp_src_19.0</code> </li>
<li><code>./configure --prefix=/home/kmaidol/erlang</code> <blockquote>
<ul>
<li>可能会报错 configure: error: No curses library functions found configure: error: /bin/sh ‘/home/kmaidol/erlang/configure’ failed for erts  </li>
<li>原因是缺少ncurses包 解决：在ubuntu系统下 <code>apt-cache search ncurses</code> <code>sudo apt-get install libncurses5-dev</code></li>
<li>继续安装erlang  <code>./configure --prefix=/home/kmaidol/erlang</code> <code>make</code> <code>make install</code></li>
</ul>
</blockquote>
</li>
<li>测试erlang 进入<code>cd /home/kmaidol/erlang</code>，启动erl测试erlang是否安装成功</li>
<li>配置erlang环境变量<blockquote>
<ul>
<li>修改/etc/profile文件，增加下面的环境变量：（vim profile    i插入  编辑完毕ESC退出   wq!强制修改）</li>
<li>#set erlang environment</li>
<li>export PATH=$PATH:/home/kmaidol/erlang/bin</li>
<li><code>source profile</code> 使得文件生效</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
<li>rabbitMq安装配置<blockquote>
<ul>
<li><code>wget https://github.com/rabbitmq/rabbitmq-server/archive/rabbitmq_v3_6_3.tar.gz</code> </li>
<li><code>tar zxvf rabbitmq_v3_6_3.tar.gz</code> </li>
<li><code>cd rabbitmq_v3_6_3</code>  <code>make</code><blockquote>
<ul>
<li>error: rabbitmq-components.mk must be updated! n this case, just run the following command to update your copy:<br><code>make rabbitmq-components-mk</code> </li>
<li><code>make install</code> </li>
</ul>
</blockquote>
</li>
<li>修改/etc/profile，添加环境变量<blockquote>
<ul>
<li>#set rabbitmq environment</li>
<li>export PATH=$PATH:/usr/rabbitmq/sbin</li>
<li><code>source profile</code> 使得文件生效</li>
</ul>
</blockquote>
</li>
<li>启动 <code>rabbitmq-server start</code> </li>
</ul>
</blockquote>
</li>
<li>apt-get安装rabbitMq<blockquote>
<ul>
<li><code>apt-get update</code>  <code>apt-get -y upgrade</code> </li>
<li>Enable RabbitMQ application repository: <code>echo &quot;deb http://www.rabbitmq.com/debian/ testing main&quot; &gt;&gt; /etc/apt/sources.list</code> </li>
<li>Add the verification key for the package: <code>curl http://www.rabbitmq.com/rabbitmq-signing-key-public.asc | sudo apt-key add -</code> </li>
<li>Update the sources with our new addition from above: <code>apt-get update</code> </li>
<li><code>sudo apt-get install rabbitmq-server</code> </li>
</ul>
</blockquote>
</li>
<li>rabbitmq web管理页面插件安装 <blockquote>
<ul>
<li><code>rabbitmq-plugins enable rabbitmq_management</code> </li>
<li>accessed using your favourite web browser by visiting: <a href="http://[your" target="_blank" rel="external">http://[your</a> IP]:15672/</li>
<li>guest具有”/“上的全部权限, 密码guest，仅能有localhost访问RabbitMQ包括Plugin，建议删除或更改密码。可通过将配置文件rabbitmq.config中添加<code>{loopback_users, []</code>来取消guest的登陆限制:<br>[{rabbit, [{loopback_users, []}]}], 然后可使用guest登陆创建一个admin用户, 之后删除这段{loopback_users, []}, guest就无法登陆了, 之后使用新用户进行登陆。二进制安装包默认没有这个配置文件(/etc/rabbitmq/rabbitmq.config), 可以从源码包中copy过来, 在源码包对应的文件<code>doc/rabbitmq.config.example</code></li>
<li>增加用户 <code>rabbitmqctl add_user username</code> 设置administrator角色 <code>rabbitmqctl set_user_tags username administrator</code>  查看用户列表 <code>rabbitmqctl list_users</code> 修改用户的密码<code>rabbitmqctl  change_password  username  newpassword</code> <blockquote>
<ul>
<li>给用户分配角色后就可以登陆web管理后台</li>
</ul>
</blockquote>
</li>
<li>新建virtual host <code>rabbitmqctl add_vhost test_host</code> , 查看 <code>rabbitmqctl list_vhosts</code> 如此用户名为test的用户就可以访问vitrual host为test_host的资源了，并且具备读写的权限 </li>
<li>分配访问权限 <code>rabbitmqctl set_permissions -p test_host  test &quot;test-*&quot; &quot;.*&quot; &quot;.*&quot;</code> </li>
</ul>
</blockquote>
</li>
<li>使用已编译安装包安装rabbitmq(只成功测试了这种安装方式可行)<blockquote>
<ul>
<li>安装erlang</li>
<li>error missing_dependencies,[crypto,ssl], 需要安装其他依赖 <code>sudo apt-get install -y erlang-nox erlang-dev erlang-src</code>   </li>
<li>获取二进制编译包 <code>wget http://www.rabbitmq.com/releases/rabbitmq-server/v3.6.3/rabbitmq-server-generic-unix-3.6.3.tar.xz</code> </li>
<li>解压 <code>xz -d rabbitmq-server-generic-unix-3.6.3.tar.xz</code> <code>tar -xvf rabbitmq-server-generic-unix-3.6.3.tar</code> </li>
<li><code>cd rabbitmq_server-3.6.3/</code> <code>cd ./sbin</code> 启动 <code>./rabbitmq-server start</code> </li>
<li>修改/etc/profile，添加环境变量<blockquote>
<ul>
<li>程序路径建议放在当前用户/home/k/目录下, 避免 sudo not found 的错误</li>
<li><code>cp -rf ./rabbitmq_server-3.6.3 /home/k/rabbitmq</code> </li>
<li>#set rabbitmq environment</li>
<li>export PATH=$PATH:/home/k/rabbitmq/sbin</li>
<li><code>source profile</code> 使得文件生效</li>
</ul>
</blockquote>
</li>
<li>启动 <code>rabbitmq-server start</code> or <code>rabbitmq-server -detached</code> 查看状态 <code>rabbitmqctl status</code> 关闭 <code>rabbitmqctl stop</code></li>
<li>启动时 error missing_dependencies,[crypto,ssl], 需要安装其他依赖 <code>sudo apt-get install -y erlang-nox erlang-dev erlang-src</code>  </li>
</ul>
</blockquote>
</li>
<li>使用官方rabbitmq docker images部署安装<blockquote>
<ul>
<li>安装docker, 并成功运行</li>
<li><code>docker pull rabbitmq</code> <a href="https://hub.docker.com/_/rabbitmq/" target="_blank" rel="external">rabbitmq docker</a></li>
<li>使用默认配置启动<br><code>docker run -d --hostname my-rabbit --name some-rabbit rabbitmq:3</code> </li>
<li>自定义 并启用 rabbitmq web 管理 , 需要使用 <code>3-management</code><br><code>docker run -d --hostname my-rabbit \
--name rabbitmq \
-p your-ip:15672:15672 \
-p your-ip:5672:5672 \
-e RABBITMQ_DEFAULT_USER=xxxx \
-e RABBITMQ_DEFAULT_PASS=xxxx \
-e RABBITMQ_DEFAULT_VHOST=my_vhost \
rabbitmq:3-management</code> <blockquote>
<ul>
<li>your-ip不指定的话, 默认就是’0.0.0.0’</li>
<li><code>docker run -d rabbitmq</code>  参数运行了容器, <code>docker exec -it rabbitmq /bin/bash</code> 可以进入容器进行管理 <code>exit</code> 退出 , 对容器修改后, 可通过 <code>commit</code> 固化为images  </li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
<li>使用frodenas/rabbitmq docker images部署rabbitmq<blockquote>
<ul>
<li>安装docker, 并成功运行 </li>
<li><code>docker pull frodenas/rabbitmq</code>  <a href="https://hub.docker.com/r/frodenas/rabbitmq/" target="_blank" rel="external">rabbitmq docker</a></li>
<li><code>docker run -d --hostname my-rabbit \
--name rabbitmq \
-p 5672:5672 \
-p 15672:15672 \
-e RABBITMQ_USERNAME=username \
-e RABBITMQ_PASSWORD=pwd \
-e RABBITMQ_VHOST=myvhost \
frodenas/rabbitmq</code> </li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
<li>ssh免密码登陆<blockquote>
<ul>
<li><code>ssh-keygen -t rsa -P &#39;&#39;</code> <blockquote>
<ul>
<li>-P表示密码，-P ‘’ 就表示空密码，也可以不用-P参数，这样就要三车回车，用-P就一次回车。它在/home/chenlb下生成.ssh目录，.ssh下有id_rsa和id_rsa.pub </li>
</ul>
</blockquote>
</li>
<li>把A机下的id_rsa.pub复制到B机下，在B机的.ssh/authorized_keys文件里，用scp复制 <code>scp .ssh/id_rsa.pub chenlb@192.168.1.181:/home/chenlb/id_rsa.pub</code>  </li>
<li>B机把从A机复制的id_rsa.pub添加到.ssh/authorzied_keys文件里 <code>cat id_rsa.pub &gt;&gt; .ssh/authorized_keys</code> <code>chmod 600 .ssh/authorized_keys</code> authorized_keys的权限要是600, A机登录B机<code>ssh 192.168.1.181</code> </li>
</ul>
</blockquote>
</li>
<li>流量监控 vnstat/iftop <blockquote>
<ul>
<li>ubuntu 下安装 <code>sudo apt-get install iftop</code></li>
<li><code>sudo iftop -i eth0</code></li>
</ul>
</blockquote>
</li>
<li>shadowsocks 限制端口流量/带宽, 流量统计, iptables</li>
</ul>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/07/06/study-github/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          study-github
        
      </div>
    </a>
  
  
    <a href="/2016/07/06/hexo-deploy/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">hexo-deploy</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">Share to: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>






<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="vps_deploy" data-title="vps-deploy" data-url="http://yoursite.com/2016/07/06/vps_deploy/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 maidol
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="//7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>